document.addEventListener("DOMContentLoaded",function(){function e(e,t){let n=document.getElementById(e);n&&(n.style.display=t?"block":"none",t?n.classList.add("show"):n.classList.remove("show"))}chrome.tabs.query({active:!0,currentWindow:!0},function(e){let t=e[0];if(t&&t.url)try{let n=new URL(t.url),i=n.hostname;document.getElementById("currentSite").textContent=i;let l="http:"===n.protocol||"https:"===n.protocol;l?chrome.runtime.sendMessage({type:"checkPausedStatus",hostname:i},function(e){if(e&&e.isPaused){document.getElementById("paused_site_section").style.display="flex",document.getElementById("disabled_site_section").style.display="none",document.getElementById("primarySection").style.display="none",document.querySelector(".main-toggle").style.display="none";let n=document.getElementById("resumeAdBlocking");n&&n.addEventListener("click",function(){chrome.runtime.sendMessage({type:"togglePause",hostname:i},function(){chrome.tabs.reload(t.id),window.close()})})}else{document.getElementById("disabled_site_section").style.display="none",document.getElementById("paused_site_section").style.display="none",document.getElementById("primarySection").style.display="block",document.querySelector(".main-toggle").style.display="block",chrome.runtime.sendMessage({type:"getStats",tabId:t.id},function(e){if(chrome.runtime.lastError){console.log("Error getting stats:",chrome.runtime.lastError);return}e&&(document.getElementById("adsPage").textContent=e.adsPage||0,document.getElementById("adsTotal").textContent=e.adsTotal||0)});let l=document.getElementById("saveAndExport");l&&l.addEventListener("click",async function(){chrome.runtime.sendMessage({action:"saveAndExportAll"},function(e){e&&e.success?console.log("✅ Data sent successfully"):console.log("❌ Error sending data:",e?.error)}),chrome.runtime.sendMessage({type:"togglePause",hostname:i},function(e){e&&console.log("Site paused:",e.isPaused),chrome.tabs.reload(t.id),window.close()})})}}):(document.getElementById("disabled_site_section").style.display="block",document.getElementById("paused_site_section").style.display="none",document.getElementById("primarySection").style.display="none",document.getElementById("statusMessage").style.display="none",document.getElementById("currentSite").style.display="none",document.querySelector(".main-toggle").style.display="none")}catch(s){document.getElementById("currentSite").textContent="Unknown Site"}else document.getElementById("currentSite").textContent="No Active Tab"});let t=document.getElementById("help_link");document.getElementById("help_container");let n=document.getElementById("help_title"),i=document.getElementById("back_icon"),l=document.getElementById("close_icon"),s=document.getElementById("help_main_menu"),o=document.getElementById("help_ad_options"),d=document.getElementById("help_ad_first_time_result"),a=document.getElementById("help_ad_everywhere_result"),c=document.getElementById("help_broken_site_result"),r=[];function y(e,t){[s,o,d,a,c].forEach(e=>{e&&(e.style.display="none")}),e&&(e.style.display="block"),t&&(n.textContent=t),r.length>0?i.style.visibility="visible":i.style.visibility="hidden"}function g(e,t){let i=[s,o,d,a,c].find(e=>"none"!==e.style.display),l=n.textContent;i&&r.push({view:i,title:l}),y(e,t)}t&&t.addEventListener("click",function(){e("help_container",!0),r=[],y(s,"How can we help?")}),l&&l.addEventListener("click",function(){e("help_container",!1)}),i&&i.addEventListener("click",function(){if(r.length>0){let t=r.pop();y(t.view,t.title)}else e("help_container",!1)}),document.getElementById("btn_see_ad").addEventListener("click",function(){g(o,"I see an ad")}),document.getElementById("btn_broken_site").addEventListener("click",function(){g(c,"The website is broken")}),document.getElementById("btn_ad_first_time").addEventListener("click",function(){g(d,"I see an ad")}),document.getElementById("btn_ad_everywhere").addEventListener("click",function(){g(a,"I see an ad")}),document.getElementById("btn_ad_first_time_ok").addEventListener("click",function(){e("help_container",!1)}),document.getElementById("btn_broken_site_reload").addEventListener("click",function(){chrome.tabs.reload(),window.close()}),document.getElementById("link_malware_help").addEventListener("click",function(e){e.preventDefault(),chrome.tabs.create({url:"https://help.getadblock.com/support/solutions/articles/6000055822-i-m-seeing-similar-ads-on-every-website-i-visit"})});let m=document.getElementById("svg_options");m&&m.addEventListener("click",function(){chrome.runtime.openOptionsPage?chrome.runtime.openOptionsPage():window.open(chrome.runtime.getURL("options.html"))});let u=document.getElementById("onpage_options");u&&u.addEventListener("click",function(t){t.preventDefault(),e("moreOptionsView",!0)});let p=document.getElementById("moreOptionsBack");p&&p.addEventListener("click",function(){e("moreOptionsView",!1)});let E=document.getElementById("toggleAds");E&&E.addEventListener("click",function(){E.classList.toggle("active")})});